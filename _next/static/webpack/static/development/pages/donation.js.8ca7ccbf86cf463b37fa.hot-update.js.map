{"version":3,"file":"static/webpack/static\\development\\pages\\donation.js.8ca7ccbf86cf463b37fa.hot-update.js","sources":["webpack:///./pages/donation/_bloc/_donation_bloc.ts"],"sourcesContent":["import { Bloc } from '@felangel/bloc';\r\nimport HelperApiRepository from '~/src/repository/helper_repository';\r\n\r\nexport abstract class DonationFormEvent {\r\n}\r\n\r\nexport class ModifyEmailEvent extends DonationFormEvent {\r\n  email: string\r\n  constructor(\r\n    email: string\r\n  ) {\r\n    super();\r\n    this.email = email;\r\n  }\r\n}\r\n\r\nexport class ModifyNameEvent extends DonationFormEvent {\r\n  name: string\r\n  constructor(\r\n    name: string\r\n  ) {\r\n    super();\r\n    this.name = name;\r\n  }\r\n}\r\n\r\nexport class ModifyCurrencyEvent extends DonationFormEvent {\r\n  currency: string\r\n  constructor(\r\n    currency: string\r\n  ) {\r\n    super();\r\n    this.currency = currency;\r\n  }\r\n}\r\n\r\nexport class ModifyPriceEvent extends DonationFormEvent {\r\n  price: number\r\n  constructor(\r\n    price: number\r\n  ) {\r\n    super();\r\n    this.price = price;\r\n  }\r\n}\r\n\r\nexport class ModifyTitleEvent extends DonationFormEvent {\r\n  title: string\r\n  constructor(\r\n    title: string\r\n  ) {\r\n    super();\r\n    this.title = title;\r\n  }\r\n}\r\n\r\nexport class ModifyCommentEvent extends DonationFormEvent {\r\n  comment: string\r\n  constructor(\r\n    comment: string\r\n  ) {\r\n    super();\r\n    this.comment = comment;\r\n  }\r\n}\r\n\r\nexport class SubmitEvent extends DonationFormEvent {\r\n  window: Window & typeof globalThis\r\n  constructor(\r\n    window: Window & typeof globalThis\r\n  ) {\r\n    super();\r\n    this.window = window\r\n  }\r\n}\r\n\r\nexport class SubmitPaypalEvent extends DonationFormEvent {\r\n  window: Window & typeof globalThis;\r\n  orderId: string;\r\n  constructor(\r\n    window: Window & typeof globalThis,\r\n    orderId: string\r\n  ) {\r\n    super();\r\n    this.window = window;\r\n    this.orderId = orderId;\r\n  }\r\n}\r\n\r\nfunction validEmail(val: string) { return !/(\\.{2}|-{2}|_{2})/.test(val) && /^[a-z0-9][a-z0-9-_\\.]+@([a-z]|[a-z0-9]?[a-z0-9-]+[a-z0-9])\\.[a-z0-9]{2,10}(?:\\.[a-z]{2,10})?$/.test(val);}\r\n\r\nexport class DonationFormState {\r\n  constructor(\r\n    readonly isEmailValid: boolean,\r\n    readonly isPriceValid: boolean,\r\n    readonly email: string,\r\n    readonly name: string,\r\n    readonly currency: string,\r\n    readonly price: number,\r\n    readonly title: string,\r\n    readonly comment: string,\r\n  ) {\r\n  }\r\n  \r\n  get isFormValid(): boolean {\r\n    // console.log(!this.email || !this.price || !(this.email === \"\") || !(this.price < 30));\r\n    return this.email !== \"\" && this.price >= 30;\r\n  }\r\n\r\n  static empty() {\r\n    return new DonationFormState(\r\n      true,\r\n      true,\r\n      \"\",\r\n      \"\",\r\n      \"TWD\",\r\n      0,\r\n      \"\",\r\n      \"\",\r\n    )\r\n  }\r\n\r\n  copyWith({\r\n    isEmailValid,\r\n    isPriceValid,\r\n    email,\r\n    name,\r\n    currency,\r\n    price,\r\n    title,\r\n    comment,\r\n  }: {\r\n    isEmailValid?: boolean,\r\n    isPriceValid?: boolean,\r\n    email?: string,\r\n    name?: string,\r\n    currency?: string,\r\n    price?: number,\r\n    title?: string,\r\n    comment?: string, \r\n  }) {\r\n    return new DonationFormState(\r\n      isEmailValid != null ? isEmailValid : this.isEmailValid,\r\n      isPriceValid != null ? isPriceValid : this.isPriceValid,\r\n      email != null ? email : this.email,\r\n      name != null ? name : this.name,\r\n      currency != null ? currency : this.currency,\r\n      price != null ? price : this.price,\r\n      title != null ? title : this.title,\r\n      comment != null ? comment : this.comment,\r\n    )\r\n  }\r\n}\r\n\r\nexport class DonationBloc extends Bloc<DonationFormEvent, DonationFormState> {\r\n  initialState(): DonationFormState {\r\n    return DonationFormState.empty();\r\n  }\r\n\r\n  async *mapEventToState(event: DonationFormEvent): AsyncIterableIterator<DonationFormState> {\r\n    if(event instanceof ModifyEmailEvent) {\r\n      yield* this._mapModifyEmailEventToState(event);\r\n    } else if(event instanceof ModifyNameEvent) {\r\n      yield* this._mapModifyNameEventToState(event);\r\n    } else if(event instanceof ModifyPriceEvent) {\r\n      yield* this._mapModifyPriceEventToState(event);\r\n    } else if(event instanceof ModifyTitleEvent) {\r\n      yield* this._mapModifyTitleEventToState(event);\r\n    } else if(event instanceof ModifyCommentEvent) {\r\n      yield* this._mapModifyCommentEventToState(event);\r\n    } else if(event instanceof ModifyCurrencyEvent) {\r\n      yield* this._mapModifyCurrencyEventToState(event);\r\n    } else if(event instanceof SubmitEvent) {\r\n      yield* this._mapSubmitEventToState(event);\r\n    } else if(event instanceof SubmitPaypalEvent) {\r\n      yield* this._mapSubmitPaypalEventToState(event);\r\n    }\r\n  }\r\n\r\n  async *_mapModifyEmailEventToState(event: ModifyEmailEvent) {\r\n    let currentState = this.currentState;\r\n    yield currentState.copyWith({\r\n      isEmailValid: validEmail(event.email),\r\n      email: event.email\r\n    })\r\n  }\r\n  async *_mapModifyNameEventToState(event: ModifyNameEvent) {\r\n    let currentState = this.currentState;\r\n    yield currentState.copyWith({\r\n      name: event.name\r\n    })\r\n  }\r\n  async *_mapModifyPriceEventToState(event: ModifyPriceEvent) {\r\n    let currentState = this.currentState;\r\n    yield currentState.copyWith({\r\n      isPriceValid: event.price >= 30,\r\n      price: event.price\r\n    })\r\n  }\r\n  async *_mapModifyTitleEventToState(event: ModifyTitleEvent) {\r\n    let currentState = this.currentState;\r\n    yield currentState.copyWith({\r\n      title: event.title\r\n    })\r\n  }\r\n  async *_mapModifyCommentEventToState(event: ModifyCommentEvent) {\r\n    let currentState = this.currentState;\r\n    yield currentState.copyWith({\r\n      comment: event.comment\r\n    })\r\n  }\r\n  async *_mapModifyCurrencyEventToState(event: ModifyCurrencyEvent) {\r\n    let currentState = this.currentState;\r\n    yield currentState.copyWith({\r\n      currency: event.currency\r\n    })\r\n  }\r\n  async *_mapSubmitEventToState(event: SubmitEvent) {\r\n    let currentState = this.currentState;\r\n    const url = await HelperApiRepository.getRedirectUrl({\r\n      title: currentState.title,\r\n      comment: currentState.comment,\r\n      email: currentState.email,\r\n      name: currentState.name,\r\n      price: currentState.currency.toLocaleLowerCase() === \"usd\" ? currentState.price * 30 : currentState.price,\r\n    });\r\n    console.log(event.window);\r\n    console.log(url);\r\n    event.window.location.href = url;\r\n  }\r\n  async *_mapSubmitPaypalEventToState(event: SubmitPaypalEvent) {\r\n    let currentState = this.currentState;\r\n    const url = await HelperApiRepository.getRedirectUrl({\r\n      title: currentState.title,\r\n      comment: currentState.comment,\r\n      email: currentState.email,\r\n      name: currentState.name,\r\n      price: currentState.currency.toLocaleLowerCase() === \"usd\" ? currentState.price * 30 : currentState.price,\r\n    });\r\n    // console.log(event.window);\r\n    // console.log(url);\r\n    // event.window.location.href = url;\r\n  }\r\n}"],"mappings":"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","sourceRoot":""}